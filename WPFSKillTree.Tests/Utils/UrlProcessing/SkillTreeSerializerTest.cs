using System.Collections.Generic;
using Moq;
using NUnit.Framework;

namespace PoESkillTree.Utils.UrlProcessing
{
    [TestFixture]
    public class SkillTreeSerializerTest
    {
        private const string NormalSized =
            "https://www.pathofexile.com/passive-skill-tree/AAAABAMBAAFvDXwOSA-rD8QRDxEvEVARlhV-FdcV7Ra_GkgbJR1PIG4i9CSLKgsqOCy_LOE1uTY9Ow07fD1fRwZJE0lRSbFLrkyzUDBSU1S9VmNW9VxAXGtd8l9qYqxjQ2nYbAhsC2yMbRlwUnBWdZ51_XzwfeN-oX_GhEiEb4auh8uJ4It6joqP-pAbkQeTH5MnlouXlZfQl_SaE52qoS-io6crpzSnm6xmrJi0DLTFtUi4yrk-u_y-isHFwzrDbcrTzxXQH9DQ1ELVudfP2HbZW9tu29Tb59-K4vfmWOkC6rrrY-wY74jv6_DV8Yry4fQo9vz31_k3";

        private const string NormalSizedParameter =
            "https://pathofexile.com/passive-skill-tree/AAAABAMBAAFvDXwOSA-rD8QRDxEvEVARlhV-FdcV7Ra_GkgbJR1PIG4i9CSLKgsqOCy_LOE1uTY9Ow07fD1fRwZJE0lRSbFLrkyzUDBSU1S9VmNW9VxAXGtd8l9qYqxjQ2nYbAhsC2yMbRlwUnBWdZ51_XzwfeN-oX_GhEiEb4auh8uJ4It6joqP-pAbkQeTH5MnlouXlZfQl_SaE52qoS-io6crpzSnm6xmrJi0DLTFtUi4yrk-u_y-isHFwzrDbcrTzxXQH9DQ1ELVudfP2HbZW9tu29Tb59-K4vfmWOkC6rrrY-wY74jv6_DV8Yry4fQo9vz31_k3";

        private const string FullTree =
            "https://www.pathofexile.com/passive-skill-tree/AAAABAABAAAGAF4AwQDuAQkBbwGRAaQBvAHRAdwB5wIRAiACOgJfAtAC4wMEA10DdQOHA5YDogPuBAcEhwSxBLME5AUtBTwFQgVmBX0FkwW1BekF-QYOBiAGIwY5BkAGSQZwBncGoAaiBuEG5wceB2MHdQelCC4IZwiJCLEI1Aj0CSwJMwlYCWsJlgm7CdkJ9gqbC2ELjQuPC8EMXwxzDHYM7QzyDPcNHw0iDWANfA2NDc0N0Q48DkgOjg8XD5gPqw_EEFEQWBB7EJcQzBDwEQ8RGhEtEVARgRGWEcIR1RHYEd0SMBJpEo4S4RMEE0wTUBNtE3ETgxPJE8wUBhQJFCAUTRRxFHUUqRSwFSAVNhVQFVYVuBXsFe0V8BX2Ff0WQBZvFqoWvxbzFxwXLxdUF5sX3BfhGDwYVhhZGF0YZRhqGJEY1xjbGO8ZLhmGGYoZjhm0GdcZ2BnpGf4aHRo4Gj4aVRpsGnIagRqNGo8a5BsBGyUbNxtFG5cbqhutG7QbyBvgG_Eb-hwTHF8cdRynHMQczhzcHRQdTx2DHaodvh3CHdkeCB5qHpQe2h7fHu4e8B8CHxgfQR9MH1sfxyAGIFkgaCBuIJwg6iEKITQhVSFgIXYhsCHAIcMigSKvItgi4iLqIvQjMSM3I18j0yPqI_YkLSQuJE4kbySLJJoknSSqJLAk2CT9JSElJyU_JV8lsiXfJjomPCZ0JogmlSb4JwsnICchJy8nWSeDJ6kn7SgqKGwo-ikPKS4pOylPKaUqCyoTKjgqTSpTKlsqYyqNKpgrCCsKK1AreCu2LEYsZCyFLJwspiynLL8s4SzpLPstHy0wLX0tgy2LLZ4tqC2pLbQtxC3SLgguIy5KLlMulC7tLyQvby-dL8wv1i_XL9owWzBxMHcwfDB_MPgxnjGwMe8x-jH7MgEyCTIYMjQyTjJYMnEyfjKUMtEzbDOHM5IzsDQKNPc1BTWSNbk11jXvNj02YjaJNsU22DboNuk3RzdNN2Y3gzfUODA4UzkOOUk5UjmZOdQ53TpCOlI6WDqtOrM6xjrYOuE66TrtOu47DTsUOyg7Ozs_O3w7ujvwPAU8KDwtPEs8Tjy9PO88_j0PPT49Xz1kPdE93T3iPew9_D5lPs8_Jz9VP2w_cz_8QKBA2kE_QWdBckGHQZZB00I6Qo5DE0MxQ1RDY0PIQ-dEBEQNRCVEikSeRKFEq0TIRQpFR0WWRZ1FqUW5RfRGDkZpRnFGt0biRv5HBkd-R7dHy0fiSHhI5UjnSO5JD0kTSRtJT0lRSVJJsUmySdVKLkpASn1KmkqfSsRKyEsKSxxLV0t4S65LvEwtTDJMs0zfTP9NRk2STaxNuU3PTeNOKk4yTm1On06uTsdPBE9WT_NQMFBCUEdQg1FHUUxRYFFjUWxRdFHmUftSKVI4UlNSslLsUw5TMVM1U1JTjVOlU7tT1FRHVGJUglSuVL1U_lVLVYVVqVWuVbVVxlXVVdZV4FYtVi5WSFZKVslW9Vb6Vw1XVFeHV5dXyFfJV9hX4VgHWBdYMVhaWGNYrlivWMhY5VltWbxZ81n8Wf5aGlorWlJakVqfWyZbb1uOW49bmVugW69b01v0XEBca1yKXSxdSV1oXY9d8l4TXkVeW15dXotepV7AXwRfKl85Xz9fal-YX7BfyWBBYENgZWCRYLNgxGDeYPhhIWEoYVJh4mHrYlBiWmJ5YoZilWKsYuxi9GMXY0FjQ2NwY6dju2RSZIRknWSjZKpkr2S1ZL1k52VNZadl8GZMZlRmnma2Zv1nWGdnZ3Fnm2egZ71n2Wf8aFhoZWh0aPJp_moBagRqG2o2akNqjGqTaqVqrGq7axdrNGusa7dryGvbbAhsC2w9bEZsc2yMbOdtGW06bWxtrG49bmlul26qbwhvO29Xb4Rvnm_ycFFwUnBWcLtw13FNcWlxanF5cYVxoXGwcbJx83IBcg9ybHKpcq9yw3LFcw5zZ3Nrc21zcHRVdKB0pXSudO108XVOdZ51y3XQdf12EXZvdn92gnasdud293cHd1N3onfCd9d34nfjd-V4DXgZeC94aXh6eK54znjrePl5OXloeX95oXmxefZ6GXpTen96i3rvew17FHsge197bnt0e4N7jHvDe9d8DnxLfIN8uHy7fNl85X0YfTt9W311fbB90n3jffV-WX6vfrB-x37dfuB-4n8Cfwd_K3-yf8Z_43_7gCKApICugTqBQYGsggeCEIIegl6Cm4LHguSDCYMWgy6DX4O2g72DzIPbg_OD94RIhFOEb4R3hIOEv4TEhMWE2YTvhTKFUoVghW2Fe4V9hY-GAoZghrOGyobOhtGHAIcThymHZYdqh3aHy4hAiEKIWohbiI-I7YlribyJ04nYieCKBooiijiKbIqvirOK5Irwi0-LZYt2i3qLjIuZi6CMC4w2jEaMdoyYjM-NGY19jX6NgY2CjbmNv448jmSOio6-jr-O6Y8aj0aPT49gj4CPmY-mj8GP8Y_6j_uQCpANkBGQMJAzkFWQbJDWkSuRzpJ9koCSwZLHktCS85MHkw-TH5MnkzqTkJOZk6iT_JP_lAeUb5SHlKCUuJTxlQSVBZUglS6VZpV9lciVzJYylmyWdJZ4louXBpcIlyGXLZd5l4WXlZe0l8GX0Jf0mAqYI5hNmFOYb5itmSuaE5oXmmGaZJpqmq6az5rgmuma8Zr-myabLZs_m1GbWJtdm2qbhpuNm6GbtZvsnAKcMpyLnKScvpzEnMedJZ1fnWOdqp2undmePJ5XnqGevZ7EnsWezZ8BnyefL58-n0ifiJ-Jn6Ofy5_foEKgQ6CfoLGg5qEioSOhL6GkogCiBKIuoj6iQKJ_oqOi2aLqo4qj76PypAWkDKQWpBmkOaR4pMKlZ6XEpcul9aYyplemcKZ_poimjaaZpqymr6a-puCm66b4pwinK6cwpzSnVaeUp5unn6elp9Sn5af4qHKofaiaqSepNKlAqUipbql5qZSplan6qliqpKqpqsSrC6suq7qsRqxHrGasl6yYrKqsr60SrTOtO61IrUqtZa2NrfGuEq4-rlCus670rv-vGK9sr3qvfK-Nr5uvp6-3r7yv6a_rsAuwd7CrsNixBbEdsTCxNrFbsXyxkLGusbOyGbIosnCzA7MOsz-0DLQvtDi0xbTRtNO1BLUItUi1hbWHtfK2AbZQtma2e7aGtoq2pLb6tyK3MLcxtzi3Prd1t7a31rfZuJO4yrjQuNm5ArkduT65Q7lvuXy5k7p_u0273bvju-28mryfvKq86r0nvTa9Xb2BvYK95r46vkm-gL6Kvqe-rb63vry-7r-Xv9W_-8AawGbAnMCmwL_A48EAwQTBB8EIwTPBScF8wX7BgsGLwaDBo8G0wcXB1cHzwiLCbMJzwo7Cj8LswwnDE8MxwzPDOsNtw3nD5sQVxDHEWMSCxKLEpMS4xM7E9sUoxVPFisaKxqrGrsbYxxnHpMfKyAzIE8gUyCPIW8ibyMzI3MjwyT3JRMlnyiTKRspKylnKkMqpytPK8st6y3_Lvcv1zAbMvMzHzRbNKs2YzerOcM6ozwrPFc8azzLPes9-z93P6dAf0CzQTNDQ0PXRNtFF0eTR_dIh0irSxdLo0xvTb9N-04DT-9P81CPUQtRS1HzUj9S01S7VZdWB1YvVptW51fjWB9ZU1ljWXdaK1r7XLddK137XltfP2AvYJNhN2FTYYNh22L3ZBtkL2RPZW9lf2WDZYdl82b_Zxtnc2jraP9pi2nbaudrB2t3bAtsL2xrbHttP21XbWdte227bp9vU2-fcI9wn3DLcPdyM3L3dDd1G3UjdX92M3ZLdqN3j3efd7t6W3rPe1N7l3vjfT99v34rfmN-g37Dfst-_4BLgVeBp4HHgw-Dd4Q_hiOGS4dvh7-Is4kPiYeKA4q3i1eL341bjYuNq44Tjn-Ow5CLkUeRV5GrkreSx5OvlGeWL5bPlz-Xm5inmWOZ95oHmiObq5wrnD-dU53Tn6uha6GbopOjV6Nbo6ekC6TPpRulQ6XbpuenV6drqGOpi6n_quusJ6xTrLOtj6-Tr7uv17BjsOOxV7HHsdOyK7LDsy-zo7T_tQe2D7dfuDu4V7m_ueu6Q7w7vIe9O71Dveu9874jvj-_r7_3wH_DE8NXw-fFs8YrxrPGz8f7yHfIe8kHyRfJa8nXyjvKX8pzy0vLh8ubzBvMJ81_zb_Ob8930GvRx9Mb05vTp9Pj1GPUv9Uv1b_X69kj2W_ai9qP2rvba9uf2_PcT9zL3ffeU96b3vvfB98_31_iC-JP4l_ih-Ov47_kz-Tf5Y_ll-bH5vfnI-dv53fno-hj6TfrS-t366_rv-vH7CfuL-5H7qvv1-_38S_xk_MX9Af0w_W79cv4J_gr-Hf5F_kn-VP5Y_mv-h_6P_rP-uv7I_vn_HP-w_83_3g==";

        private const string FullTreePoePlanner =
            "https://poeplanner.com/ABMADP0AExAABnsAXgDuAQkBbwGRAbwB0QHcAecC0ALjA3UDhwOWA-4EBwSHBLEEswTkBS0FPAVCBWYFkwW1BfkGDgYgBiMGOQZJBnAGdwagBqIHHgdjB3UHpQguCGcIiQixCNQI9AkzCVgJlgm7CfYKmwthC8EMXwxzDPIM9w0fDXwNjQ3NDdEOPA5IDo4Pqw_EEFgQexCXEMwQ8BEPERoRLRFQEYERlhHCEdUSaRLhE0wTUBNtE3ETgxPJE8wUCRQgFE0UcRR1FKkUsBUgFVAVuBXsFe0V8BX9FkAWbxaqFr8W8xccFy8XVBfcF-EYPBhWGF0YZRhqGJEY1xjbGS4ZhhmKGY4ZtBnXGekZ_ho4Gj4aVRpsGoEajRqPGuQbARslG0UblxuqG60byBvgG_Eb-hynHM4c3B0UHU8dgx2qHb4d2R6UHt8e8B8CHxgfWx_HIG4gnCE0IVUhYCGwIcAhwyKBIq8i4iLqIvQjMSNfI9Mj9iSLJJ0kqiSwJNgk_SUnJd8mPCaIJpUm-CcLJyAnIScvJ6kn7SgqKPopLilPKaUqCyoTKjgqTSpTKlsqjSqYKworUCt4K7YsRiyFLJwspiynLL8s4SzpLPstHy0wLX0tgy2LLagt0i4ILiMuUy6UL28vnS_MMFswcTB3MHwxnjGwMfox-zIBMgkyGDI0Mk4yfjKUMtEzhzOSNAo09zWSNbk11jXvNj02iTbFNtg26DbpN0c3ZjeDN9Q4UzkOOVI51DndOkI6UjpYOq06szrYOuE67TsNOyg7Ozt8PAU8KDwtPL087z0PPT49Xz3RPd094j38Ps8_Jz9zP_xAoEE_QXJBh0GWQo5DE0MxQ1RDY0PIQ-dEBEQNRIpEnkShRKtFCkVHRZZFnUWpRblF9EZpRnFGt0cGR35Ht0fiSHhI50juSQ9JE0kbSVFJsUmySdVKLkp9SppKxErISwpLHEtXS3hLrkwtTDJMs0z_TUZNkk25TeNOKk4yTm1On06uTwRPVk_zUDBQQlBHUUdRTFFgUWxRdFHmUftSKVJTUrJS7FMxUzVTUlOlU7tT1FRHVIJUrlS9VP5VS1WFValVrlW1VcZV1VXWVeBWLVZIVkpW9Vb6Vw1XVFeHV5dXyVfYV-FYB1haWGNYr1jlWW1ZvFnzWf5aGlorWlJakVqfWyZboFuvW_RcQFxrXIpdSV1oXfJeE15FXl1ei16lXsBfBF8qXzlfP19qX5hfsGBBYENgZWCRYMRhIWFSYeJh62JaYpVirGLsYxdjQ2NwY6dkUmSEZJ1ko2SqZK9k52VNZadmVGaeZrZnWGdnZ5tnoGe9Z_xoWGhlaHRo8mn-agFqBGo2akNqjGqTaqVqrGsXa6xrt2vbbAhsC2xGbIxs520ZbTptbG49bmlul26qbwhvO2-Eb55v8nBRcFJwu3FNcXlxhXGwcg9ybHKpcsNza3Ntc3B0VXSgdK507XTxdZ51y3XQdf12EXZvdn92gnasdud293cHd1N313fjeA14GXgveGl4eniueM5463k5eWh5oXn2elN6f3rvew17FHsge3R7jHvDe9d8DnxLfIN8uHy7fNl85X0YfVt9dX3SffV-WX6vfrB-x37gfuJ_An8rf8Z_43_7gKSAroE6gUGBrIIHghCCHoJegseC5IMJg1-DtoO9g8yD24Pzg_eESIRvhMSExYTZhO-FMoVShWCFbYV7hX2GAoZghrOG0YcThymHZYdqh3aHy4hAiEKIWohbiI-I7YlridOJ2IngigaKIoo4iq-Ks4rkivCLT4t6i4yLmYwLjDaMRox2jM-NGY19jX6NgY2Cjb-OPI5kjoqOvo6_jumPGo9Gj2CPmY-mj8GP-pAKkA2QEZAzkFWQbJDWkSuRzpJ9ksGS0JLzkweTH5MnkzqTkJOZk6iT_JRvlIeUoJS4lQSVBZUglS6VZpXIlcyWMpZslnSWi5cGl3mXhZeVl7SX0Jf0mAqYb5itmSuaYZpqms-a4JrxmyabLZtYm12bapuGm42boZu1m-ycMpyknL6cxJ2qna6d2Z48nleeoZ7EnsWezZ8BnyefPp-In6Ofy5_foEKgQ6CfoSKhL6GkogCiBKIuokCio6LZouqjiqPvo_KkGaQ5pHikwqXEpcumV6Z_ppmmrKa-puunCKcrpzCnNKdVp5Snm6efp6Wn1Kh9qJqpJ6k0qW6plKmVqfqqxKsLrEesZqyXrJisqqyvrTOtSq2NrfGuEq4-rlCus69sr42vm6-nr7ev67ALsHewq7DYsQWxNrGQsbOyGbJwswOzDrM_tAy0L7Q4tMW00bUEtUi1hbXytoa2iraktvq3IrcwtzG3Prd1t7a31rfZuJO4yrjQuNm5Hbk-uUO5b7l8uZO7Tbvju-28mryfvOq9J702vYG9gr3mvjq-gL6Kvqe-vL7uv5e_1cAawGbAnMCmwL_A48EAwQTBB8EzwUnBgsGLwaDBo8G0wcXB1cHzwnPCjsLswwnDE8MzwzrDbcQVxFjEgsSixLjE9sUoxVPFisauxtjHysgMyBTII8hbyMzI3MjwyT3JRMlnykrKkMqpytPLvcv1zAbMvM0WzZjN6s5wzqjPCs8VzzLPes9-z93P6dAf0NDQ9dE20eTR_dIh0xvTb9N-0_vT_NQj1ELUUtR81I_VLtWB1YvVudX41gfWWNaK1r7XLdd-15bXz9gL2CTYTdhU2GDYdti92QvZE9lb2V_ZYdl82cbaOtpi2rnawdrd2wLbC9sa20_bVdtZ217bbtun2-fcI9wy3D3cvd0N3UbdSN1f3YzdqN3j3efelt7l3vjfb9-K35jfsN-y37_gEuDD4Yjh2-Hv4iziQ-Jh4oDi1eL341bjauOE45_kIuRR5K3kseTr5Rnli-XP5ebmWOaB5ojnCucP51TndOfq6FroZuik6NXo1ukC6Ubp1eoY6mLquusJ6xTrLOtj6-Tr7uv17BjsOOxV7HTsiuyw7MvtP-1B7YPt1-4O7hXueu8O707vUO9673zviO-P7-vwH_DV8PnxbPGK8azxs_H-8h3yHvJB8kXyWvKX8pzy4fMG8wnzb_Ob8930cfTG9Ob06fT49Uv1b_ZI9lv2o_au9tr25_b89zL3pve-98H31_iT-KH46_kz-Tf5Y_ll-b35yPnb-d356PoY-tL66_rv-vH7CfuL-6r79fxL_GT8xf0w_gn-Cv4d_kn-VP5r_of-j_6z_rr-yP8c_7D_3ptRi3ZWLjrpHgjs6Kfl0iov2pctSU-8qqqpJSFg-FfIbazHpN9P4ZLe1CkP9BrIm2L0cbI6xqDmZ3FKn5hNEFGJvHmxrTsrCCAGM2w5SRu0oSNHy5rptnu2UFjI2x49ZLGuhL_EzocAQWevGBnYu92-SR7ai2UyWEI6Me8kLcgTM7AlXy_WWDEacmq7FVYcxP750sVYrp1jcWnK8nSlahuci2fZHu6l9cF-Oz9hKIbKxopG_qf4J4MyceBxe4ObP9OANQUMdiSarUgaHXLFa8ivfNdKbD1w15fBOZnKWdFFJbJihp69y38gaPKO4Q-Ed1RicfN3wmNBeX_g3QksrvRTDtWmgpsw-Hfl5FWu__Nf6VABpCROEdiEg-Z97yGifwbhj_vadveUnSV6GZQHFTZiUF5bxDHZ3DruLu1G4sIi-k0cdS_X3CcqY696vq0DXexxhY-DLv5YODA2YmS1mv4LjdVl-t08TiDqcWqKbGO7TazCbJcI3IyTD_DEqy6MmBQGCWsttMcZUWNZ_No_xqpyr0YO-O-T_5-J6bkj6tAsOxTEpBebsR3qf-5vtNMCIB5q2WDes__Nf7L9cuBpXY8_VeYpJ1m_-8EILGSqpOl2cgHls307c2eVfWXwpo11TpzHJC7-RcN5hs6-tyF2puBm_TB_j4AcEwOicaG1CI9P9RhzDklS9xMobF_JbHPDMV0sS7zLemZMfwedX4ugzMcCOneiFfZieQAGQdMvJLp_0Eyv6TvwgCI_bK1lmheSgE3P2b8bN_ai9S8tnpAwIQro6a0SVskY7-naEjAmOhHdDO2DFqpY98_5sQ0iAhH9AY_xHF9bmfiCpohrNDu647ASjv1usXzD5o25ePl-3QXpJnS2AQuP5Gqped3utmZEyC5KeoufLxhZDWAFffv9DxdOx33jD5jCj5LHW2-kFkjlrEZQg6Zwr7zfoL1dW9PWVJwCsTAlPyk7Uji1hzz-EwRvV_LmmCMG56QFfbAfTB9BmFOU8fiXBkB7X_J1ZL3UtD3s6TOpQFuOQNqgsVuPmmQjNzdNmhPb1HBWn0hM31ONPmXPGqb4zSqyKC3E-5HZBsok5urjYvX6tzhKQC2pItiWeLkCpWcAwQJfAwQJ2R3CIFkkbzxLRCVYF2CzYN534ntuhFOXIZquoj6kDKYypq-ocqlIq7qxW8F8ykbS6NZd3ZLgVeKt7pDv_fLS930AAAAAAA==";

        [TestCase(NormalSizedParameter, ExpectedResult = NormalSized)]
        [TestCase(FullTree, ExpectedResult = FullTree)]
        [TestCase(FullTreePoePlanner, ExpectedResult = FullTree)]
        public string ToUrlReturnsCorrectResult(string url)
        {
            var sut = CreateSut(url);

            return sut.ToUrl();
        }

        private static SkillTreeSerializer CreateSut(string url)
        {
            var buildConverter = new BuildConverter(null!,
                u => new NaivePoEUrlDeserializer(u, null!),
                PathofexileUrlDeserializer.TryCreate,
                PoeplannerUrlDeserializer.TryCreate);
            var buildData = buildConverter.GetUrlDeserializer(url).GetBuildData();
            var allNodesMock = new Mock<IReadOnlyCollection<ushort>>();
            allNodesMock.As<ICollection<ushort>>()
                .Setup(c => c.Contains(It.IsAny<ushort>())).Returns(true);
            return new BuildUrlDataToUrlSerializer(buildData, allNodesMock.Object);
        }
    }
}